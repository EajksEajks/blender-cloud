| {% extends 'layout.html' %}
| {% from '_macros/_navigation.html' import navigation_project %}

include ../../../../pillar/src/templates/mixins/components

| {% set title = 'landing' %}

| {% from '_macros/_asset_list_item.html' import asset_list_item %}

| {% block page_title %}{{ project.name }}{% endblock%}

| {% block og %}
meta(property="og:type", content="website")

| {% if og_picture %}
meta(property="og:image", content="{{ og_picture.thumbnail('l', api=api) }}")
meta(name="twitter:image", content="{{ og_picture.thumbnail('l', api=api) }}")
| {% elif node and node.picture %}
meta(property="og:image", content="{{ node.picture.thumbnail('l', api=api) }}")
meta(name="twitter:image", content="{{ node.picture.thumbnail('l', api=api) }}")
| {% elif project.picture_header %}
meta(property="og:image", content="{{ project.picture_header.thumbnail('l', api=api) }}")
meta(name="twitter:image", content="{{ project.picture_header.thumbnail('l', api=api) }}")
| {% endif %}

| {% if show_project %}
meta(property="og:title", content="{{ project.name }} - Blender Cloud")
meta(name="twitter:title", content="{{ project.name }} - Blender Cloud")
meta(property="og:description", content="{{ project.summary }}")
meta(name="twitter:description", content="{{ project.summary }}")
meta(property="og:url", content="{{ url_for('projects.view', project_url=project.url, _external=True) }}")
| {% else %}

| {% if node %}
meta(property="og:title", content="{{ node.name }} - Blender Cloud")
meta(name="twitter:title", content="{{ node.name }} on Blender Cloud")

| {% if node.node_type == 'post' %}

| {% if node.properties.content %}
meta(property="og:description", content="{{ node.properties.content | truncate(180) }}")
meta(name="twitter:description", content="{{ node.properties.content | truncate(180) }}")
| {% else %}
meta(property="og:description", content="Blender Cloud, your source for open content and training")
meta(name="twitter:description", content="Blender Cloud, your source for open content and training")
| {% endif %}

| {% else %}

| {% if node.description %}
meta(property="og:description", content="{{ node.description | truncate(180) }}")
meta(name="twitter:description", content="{{ node.description | truncate(180) }}")
| {% else %}
meta(property="og:description", content="Blender Cloud, your source for open content and training")
meta(name="twitter:description", content="Blender Cloud, your source for open content and training")
| {% endif %}

| {% endif %}

meta(property="og:url", content="{{url_for('projects.view_node', project_url=project.url, node_id=node._id, _external=True)}}")
| {% else %}
meta(property="og:title", content="{{ project.name }} Blog on Blender Cloud")
meta(name="twitter:title", content="{{ project.name }} Blog on Blender Cloud")
meta(property="og:description", content="{{ project.summary }}")
meta(name="twitter:description", content="{{ project.summary }}")

meta(property="og:url", content="{{url_for('projects.view', project_url=project.url, _external=True)}}")
| {% endif %}

| {% endif %}
| {% endblock og %}

| {% block page_overlay %}
#page-overlay.video
	.video-embed
#others
| {% endblock %}

| {% block css %}
link(href="{{ url_for('static_pillar', filename='assets/css/font-pillar.css') }}", rel="stylesheet")
link(href="{{ url_for('static_cloud', filename='assets/css/project-main.css') }}", rel="stylesheet")
| {% endblock %}

| {% block navigation_tabs %}
| {{ navigation_project(project, navigation_links, title) }}
| {% endblock navigation_tabs %}

| {% block body %}
+jumbotron(null, null, "{{ project.picture_header.thumbnail('h', api=api) }}")

.container-fluid.landing
	.row
		.col-md-8.mx-auto
			.node-details-description
				h2.pt-5 {{ project.name }}
				| {% if project.description %}
				| {{ project | markdowned('description') }}
				| {% endif %}

	.row
		.col-md-10.mx-auto
			section.py-5
				h2.pb-3.text-center Gallery

				.gallery.mx-auto
					| {% for n in activity_stream %}
					| {% if n.node_type not in ['comment', 'post'] and n.picture %}
					.thumbnail.expand-image-links
						.img-container
							a.js-open-overlay(href="{{ n.picture.thumbnail('l', api=api) }}", data-node_id="{{ n._id }}")
								img(src="{{ n.picture.thumbnail('l', api=api) }}", alt="{{ n.name }}")
					| {% endif %}
					| {% endfor %}
					div(class="clearfix")
					| {% if project.nodes_featured %}
					| {# In some cases featured_nodes might might be embedded #}
					| {% if '_id' in project.nodes_featured[0] %}
					| {% set featured_node_id=project.nodes_featured[0]._id %}
					| {% else %}
					| {% set featured_node_id=project.nodes_featured[0] %}
					| {% endif %}
					.text-center.p-5
						a.btn.btn-outline-primary.px-5(
							href="{{ url_for('projects.view_node', project_url=project.url, node_id=featured_node_id) }}")
							| See More Artwork
					| {% endif %}


	.row
		.col-md-10.mx-auto

			h2.pb-3.text-center Latest Updates

			| {% if activity_stream %}
			+card-deck(class="px-2")
					| {% for n in activity_stream %}
					| {% if n.node_type == 'post' %}
					| {{ asset_list_item(n, current_user) }}
					| {% endif %}
					| {% endfor %}
			| {% endif %}

.text-center.p-5
	a.btn.btn-outline-primary.px-5(href="{{ url_for('main.project_blog', project_url=project.url) }}") See All Updates

| {% endblock body %}


| {% block footer_scripts %}
script.
	// Click anywhere in the page to hide the overlay
	function hideOverlay() {
		$('#page-overlay.video').removeClass('active');
		$('#page-overlay.video .video-embed').html('');
	}

	$(document).click(function () {
		hideOverlay();
	});

	$(document).keyup(function (e) {
		if (e.keyCode == 27) {
			hideOverlay();
		}
	});

	$("a.js-open-overlay").on( "click", function(e) {
		e.preventDefault();
		e.stopPropagation();

		$('#page-overlay').addClass('active');
		var url = $(this).attr('href');
		$('#page-overlay').html('<img src="' + url + '"/>')
	});


| {% endblock %}
