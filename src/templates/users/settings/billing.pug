| {% extends 'layout.html' %}
| {% block head %}
style(type='text/css').
	button#recheck_subscription {
		margin-top: 1em;
	}
| {% endblock %}
| {% block body %}
| {% set renew_url = url_for('cloud.renew_subscription') %}
.container
	#settings
		| {% include 'users/settings/_sidebar.html'%}
		#settings-container
			.settings-header
				.settings-title Subscription

			.settings-content
				| {% if current_user.has_cap('can-renew-subscription') %}
				| {% if current_user.has_cap('subscriber') %}
				h3.subscription-active
					i.pi-check
					|  Your subscription is active
				h4 Thank you for supporting us!
				hr
				p Subscription expires on: <strong>{{ store_user['expiration_date'][:10] }}</strong>
				| {% else %}
				h3.subscription-missing
					i.pi-info
					a(href="{{renew_url}}") Your subscription can be renewed
				hr
				p.text-danger Subscription expired on: <strong>{{ store_user['expiration_date'][:10] }}</strong>
				p
					a.btn.btn-success(href="{{renew_url}}") Renew now
				| {% endif %}

				p
					a(href="https://store.blender.org/my-account/subscriptions/") Manage your subscription on Blender Store

				| {% elif 'demo' in groups %}
				h3.subscription-demo
					i.pi-heart-filled
					| You have a free account

				hr

				p You have full access to the Blender Cloud, provided by the Blender Institute. This account is meant for free evaluation of the service. Get in touch with #[a(href="mailto:cloudsupport@blender.org") cloudsupport@blender.org] if you have any questions.

				| {% else %}
				h3.subscription-missing
					i.pi-info
					| You do not have an active subscription.
				h3
					a(href="https://store.blender.org/product/membership/") Get full access to Blender Cloud now!
				| {% endif %}

				hr
				p
					button#recheck_subscription.btn.btn-default(onclick="javascript:recheck_subscription(this)") Re-check my subscription


script.
	function recheck_subscription(button) {
		$(button).text('Checking');

		$.get('/api/bcloud/update-subscription')
		.done(function() {
			window.location.reload();
		})
		.fail(function(err) {
			if (err.status == 403) {
				/* This happens when we are no longer logged in properly, so just refresh the
				 * page to get a proper status. */
				window.location.reload();
				return;
			}
			alert('Unable to update subscription, please check your internet connection.');
		})
		;
	}

| {% endblock %}
